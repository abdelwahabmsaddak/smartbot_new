<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced Analysis</title>
    <link rel="stylesheet" href="/static/style.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    {% extends "base.html" %}

{% block content %}
<h2>ğŸ”¥ Dashboard</h2>

<p>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ {{ user.username }} ğŸ‘‹</p>
{% endblock %}
    
<div class="container">

    <h2>ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø¹Ù…Ù„Ø§Øª</h2>

    <div class="input-box">
        <input type="text" id="symbol" placeholder="BTCUSDT Ù…Ø«Ù„Ø§">
        <button onclick="loadAnalysis()">Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
    </div>

    <hr>

    <canvas id="chart" height="130"></canvas>

    <h3>ğŸ“ˆ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>

    <div class="indicators">
        <label><input type="checkbox" class="indicator" value="ma"> MA</label>
        <label><input type="checkbox" class="indicator" value="ema"> EMA</label>
        <label><input type="checkbox" class="indicator" value="macd"> MACD</label>
        <label><input type="checkbox" class="indicator" value="rsi"> RSI</label>
        <label><input type="checkbox" class="indicator" value="stoch"> Stochastic</label>
        <label><input type="checkbox" class="indicator" value="volume"> Volume</label>
        <label><input type="checkbox" class="indicator" value="support"> Support/Resistance</label>
        <label><input type="checkbox" class="indicator" value="whales"> Whale Tracking</label>
        <label><input type="checkbox" class="indicator" value="ema"> EMA</label>
        <label><input type="checkbox" class="indicator" value="bb"> Bollinger Bands</label>
    </div>

    <div id="results"></div>

</div>

<script>
function loadAnalysis() {
    let symbol = document.getElementById("symbol").value;
    let indicators = Array.from(document.querySelectorAll(".indicator:checked"))
                          .map(i => i.value);

    fetch("/analysis_api", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({symbol, indicators})
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("results").innerHTML = `
            <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</h3>
            <pre>${JSON.stringify(data, null, 2)}</pre>
        `;
    });
}
</script>

</body>
</html>
